<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ZeroP</title>

    <!-- Bootstrap -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.6/darkly/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.1/animate.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet" >
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" >

    <style>
	    body {
			padding-top: 128px;
		}
.info-box {
    display: block;
    min-height: 90px;
    background: #fff;
    width: 100%;
    box-shadow: 0 1px 1px rgba(0,0,0,0.1);
    border-radius: 2px;
    margin-bottom: 15px;
}
.info-box-content {
    padding: 5px 10px;
    margin-left: 90px;
    color: #000000;
}
.info-box-icon {
    border-top-left-radius: 2px;
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
    border-bottom-left-radius: 2px;
    display: block;
    float: left;
    height: 90px;
    width: 90px;
    text-align: center;
    font-size: 45px;
    line-height: 90px;
    background: rgba(0,0,0,0.2);
}
.bg-aqua, .callout.callout-info, .alert-info, .label-info, .modal-info .modal-body {
    background-color: #3498db !important;
}
.bg-red, .callout.callout-danger, .alert-danger, .alert-error, .label-danger, .modal-danger .modal-body {
    background-color: #dd4b39 !important;
}
.bg-green, .callout.callout-success, .alert-success, .label-success, .modal-success .modal-body {
    background-color: #0ce3ac !important;
}
.bg-yellow, .callout.callout-warning, .alert-warning, .label-warning, .modal-warning .modal-body {
    background-color: #f39c12 !important;
}.info-box-text {
    text-transform: uppercase;
}
.progress-description, .info-box-text {
    display: block;
    font-size: 14px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
	</style>
  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand">
            ZeroP
          </a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="http://etherscan.io/address/0x43bbc7fafb860d974037b8f7dd06b6f6fe799b3e#code" target="_blank"><strong>View Contract Source Code</strong></a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>
    <div class="container-fluid">  
	    

	    
    
      <div class="row">        
        <div class="col-md-12">
        
        
        <div align="center">
	            <strong>To Participate, Send Between .01 and 10 ETH To: <h1 style="color:#0ce3ac;"><span id="address">0x43bbc7fafb860d974037b8f7dd06b6f6fe799b3e</span></h1></strong></div><br /><br />
	                    
        
        <div align="center" id="loadingText"><h2>Please Wait...<br />Loading Data Directly From Ethereum Network<br />This may take a bit...</h2><br />If it does not load check the console log for errors or try a different node below</div><br><Br>
        
       	 </div>
        </div>
        
        
        

 <div class="row" style="display:none" id="dashboardstats" class="bounceInDown animated">
        <div class="col-md-3 col-sm-6 col-xs-12">
          <div class="info-box">
            <span class="info-box-icon bg-aqua"><i class="ion ion-bag"></i></span>

            <div class="info-box-content">
              <span class="info-box-text">Contract Balance</span>
              <span class="info-box-number" id="contractbalance">calculating...</span>
            </div>
            <!-- /.info-box-content -->
          </div>
          <!-- /.info-box -->
        </div>
        <!-- /.col -->
        <div class="col-md-3 col-sm-6 col-xs-12">
          <div class="info-box">
            <span class="info-box-icon bg-red"><i class="ion ion-ios-people-outline"></i></span>

            <div class="info-box-content">
              <span class="info-box-text">Total Number of Participants</span>
              <span class="info-box-number" id="totalparticipants">calculating...</span>
            </div>
            <!-- /.info-box-content -->
          </div>
          <!-- /.info-box -->
        </div>
        <!-- /.col -->

        <!-- fix for small devices only -->
        <div class="clearfix visible-sm-block"></div>

        <div class="col-md-3 col-sm-6 col-xs-12">
          <div class="info-box">
            <span class="info-box-icon bg-green"><i class="ion ion-ios-people"></i></span>

            <div class="info-box-content">
              <span class="info-box-text">Next Payout After</span>
              <span class="info-box-number" id="nextparticipant">calculating...</span>
            </div>
            <!-- /.info-box-content -->
          </div>
          <!-- /.info-box -->
        </div>
        <!-- /.col -->
        <div class="col-md-3 col-sm-6 col-xs-12">
          <div class="info-box">
            <span class="info-box-icon bg-yellow"><i class="ion ion-code-download"></i></span>

            <div class="info-box-content">
              <span class="info-box-text">Deposits In Queue</span>
              <span class="info-box-number"  id="totalqueue">calculating...</span>
            </div>
            <!-- /.info-box-content -->
          </div>
          <!-- /.info-box -->
        </div>
        <!-- /.col -->
      </div>

        
        
        
    
      <div class="row">        
        <div class="col-md-12">
        
 
         
          <div class="panel panel-info" id="benefactorpanel" style="display:none;">
            <!-- Default panel contents -->
            <div class="panel-heading">
              Payout Queue
            </div>
            <table class="table table-striped">
              <thead>
                <th>#</th>
                <th>Address</th>
                <th>Amount Deposited</th>
                <th>Amount To Payout (125%)</th>
                <th>Deposits Needed Until Payout</th>
              </thead>
              <tbody id="nextPayout"></tbody>
            </table>
          </div>
        </div>
        <div class="clearfix"></div>
	  </div>    
    
    <hr>
    
        <div class="panel panel-default">
          <div class="panel-heading clearfix">
            Connection To Ethereum Network
          </div>
          <div class="panel-body clearfix">
            <div class="form-group col-md-6">
              <label for="ethereum-node">Node</label>
              <input type="text" class="form-control" id="ethereum-node" placeholder="Node" value="http://dev.ethereumwall.com:28545">
            </div>
            <div class="form-group col-md-6">
              <label for="contract-address">Contract Address</label>
              <input type="text" class="form-control" id="contract-address" placeholder="Contract-address" value="0x43bbc7fafb860d974037b8f7dd06b6f6fe799b3e">
            </div>
            <div class="form-group col-md-12">
              <button type="button" class="btn btn-default" id="connect" onclick="connect()">Connect</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="modalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="modalLabel"></h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-beta1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha/js/bootstrap.min.js"></script>
    <script src="https://www.myetherwallet.com/js/etherwallet-static.min.js"></script>
    <script src="http://ethereumwall.com/assets/js/web3.min.js"></script>
	<script>

    var numberOfBenefactors = 0;
    var nextToUpdate = 0;
    var payoutIndex = 0;
    var contractBalance=0;
    var address = [];
    var amount = [];

function connect() {
    if (typeof web3 === 'undefined') {
        window.web3 = new Web3();
    }

    web3.setProvider(new web3.providers.HttpProvider($("#ethereum-node").val()));

    abi = JSON.parse('[{"constant":true,"inputs":[],"name":"MAX_VALUE","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"payouts","outputs":[{"name":"addr","type":"address"},{"name":"yield","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[],"name":"payoutIndex","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[],"name":"RET_MUL","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[],"name":"MIN_VALUE","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[],"name":"payoutTotal","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[],"name":"RET_DIV","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"inputs":[],"type":"constructor"}]');

    window.ethContract = web3.eth.contract(abi).at($("#contract-address").val());
    
    
 	  
	web3.eth.getBalance($("#contract-address").val(), function(error, result) {
		if (error) {
			
        }else {
            contractBalance=web3.fromWei(result, "Ether");
            $("#contractbalance").text( contractBalance );
        }
		
	}); 
	
    
    
    nextToUpdate = 0;

	payoutIndex = ethContract.payoutIndex()['c'][0];
	console.log(payoutIndex);
	
	
	$("#nextparticipant").text("#"+payoutIndex);
    
    console.log(ethContract);
    
    nextToUpdate=payoutIndex;

    updateBenefactors();


    $('#benefactorpanel').show();

}


function update() {
	
	

	numberOfBenefactors = address.length;
	console.log("number of benefactors in queue: "+numberOfBenefactors);
	
	console.log("number of benefactors total: "+numberOfBenefactors+payoutIndex);
	
	
	$("#totalparticipants").text(numberOfBenefactors+payoutIndex);
	
	$("#nextparticipant").text(((amount[payoutIndex]/10000) - contractBalance) + " ETH");
	
    console.log(address);
    console.log(amount);
    console.log(payoutIndex);
    
	
	for (i =payoutIndex; i < numberOfBenefactors; i++) {


    console.log(">>>");
    console.log(i);

	depositsbeforepayout = 0;

    for (j = payoutIndex; j <= i; j++) {
		depositsbeforepayout = depositsbeforepayout+amount[j];
	}

	depositsbeforepayout = depositsbeforepayout- contractBalance;
	

	console.log(depositsbeforepayout);
	console.log(address[i]);
	console.log(amount[i]);
	
    console.log(">>>");
	
	if(address[i] !="" && address[i] !="0x" && address[i] !=undefined){
	    
    $("#needed4payout-" + i).html((depositsbeforepayout/10000)+" ETH");
	$("#totalqueue").text((depositsbeforepayout/10000)+" ETH");
	
	}
	

	}
	


    $('#dashboardstats').show();
    $('#loadingText').hide();
}

function updateBenefactors() {

	i = nextToUpdate;
	
	thispayout = ethContract.payouts(i);
	
	console.log(thispayout);

	benefactor = thispayout[0];
	address[i]=benefactor;	
	
	benefactoramount = thispayout[1]['c'][0];
	amount[i]=benefactoramount;

	if(benefactor!="0x"){

	htmlToInsert = '<tr id="addressLine' + benefactor + '" class="bounceInDown animated"><td>' + (i + 1) + '</td><td><div class="addressIdenticon-' + benefactor + '" style="width:30px;height:30px;float:left;border-radius: 50%;box-shadow: inset 0 2px 2px hsla(0,0%,100%,.5),inset 0 -1px 8px rgba(0,0,0,.6);"></div> &nbsp; <a href="https://etherscan.io/address/' + benefactor + '#internaltx" target="_blank" style="font-size:14pt;">' + benefactor + '</a></td><td>' + ((benefactoramount/1.25)/10000) + ' ETH</td><td>' + (benefactoramount/10000) + ' ETH</td><td><div id="needed4payout-'+i+'">calculating...</div></td></tr>';

    $('#nextPayout').prepend(htmlToInsert);
    
    
	
	if(address[i] !="" && address[i] !="0x" && address[i] !=undefined){
    
    $(".addressIdenticon-" + address[i]).css("background-image", 'url(' + blockies.create({
			seed: address[i].toLowerCase(),
			size: 8,
			scale: 8
	}).toDataURL() + ')');
	
	}

	
	nextToUpdate++;
	updateAgain = setTimeout(updateBenefactors, 1);
	}else{
	update();
	}
	
}

//Auto Connect
updateContractData = setTimeout(connect, 1);


</script>
  
  
  
  </body>
</html>
